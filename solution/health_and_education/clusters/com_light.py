"""Health & Education solution model for Commercial Light Cluster
   Excel filename: CORE_PopulationChange_29Jan2020 (version 1.5).xlsx
   Excel sheet name: ComLight_cluster
"""
import pathlib
import numpy as np
import pandas as pd
import sys
__file__ = 'c:\\Users\\sunishchal.dev\\Documents\\solutions\\solution\\health_and_education\\clusters'
repo_path = str(pathlib.Path(__file__).parents[2])
sys.path.append(repo_path)
# sys.path.append('c:\\Users\\sunishchal.dev\\Documents\\solutions')

from model import advanced_controls as ac
from solution.health_and_education.clusters import cluster_model

DATADIR = pathlib.Path(__file__).parents[0].joinpath('data')
THISDIR = pathlib.Path(__file__).parents[0]

name = 'Health and Education - Commercial Light Cluster'
solution_category = ac.SOLUTION_CATEGORY.REDUCTION 
period_start = 2020
period_end = 2050

# % impact of educational attainment on uptake of Family Planning:
assumptions = {
    'fixed_weighting_factor': None,
    'pct_impact': 0.50,
    'use_fixed_weight': 'N',
    'Twh_per_TWh': 19.8579168170079,
    'period_start': 2020,
    'period_end': 2050,
    'Grid': 'Y',
    'Fuel': 'Y',
    'Other Direct': 'N',
    'Indirect': 'N'
}

# TABLE 1: Current TAM Mix
current_tam_mix_list = [
        ['Energy Source', 'Weighting Factor', 'Include in SOL?', 'Include in CONV?'],
        ['(LFL) Linear fluorescent lamp', 75, 'N', 'Y'],
        ['(CFL) Compact fluorescent lamp', 10, 'N', 'Y'],
        ['Incandescent & Halogen lamp', 2, 'N', 'Y'],
        ['(HID) High-intensity discharge lamp', 10, 'N', 'Y']]

# Table 2: REF2, Commercial Lighting Demand TAM (Plmh)										
# ComLight_cluster!B28:K75
# TODO: Replace this with solarpvutil.Scenario.ref_tam_per_region once we resolve the data mismatch
ref2_tam_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [51.45487193, 14.6389084, 1.992069204, 22.82947281, 3.948231058, 1.260385887, 17.43928237, 4.694814929, 6.846265699, 7.492431673], 
        [54.44646738, 16.71153886, 2.069993949, 24.55327312, 4.038832628, 1.292897568, 19.19419539, 4.841474341, 7.308533527, 7.593933951], 
        [57.08154589, 16.55297255, 2.150866495, 25.94288574, 4.223522213, 1.332740261, 20.03578642, 5.298852948, 7.344699597, 7.704709269], 
        [59.80876287, 16.42730049, 2.232938124, 27.39580666, 4.416441101, 1.374913758, 20.87855549, 5.802120171, 7.387071877, 7.817187528], 
        [62.62774948, 16.33302942, 2.316208156, 28.91104178, 4.618777108, 1.419376816, 21.72201069, 6.351153017, 7.435354865, 7.931364925], 
        [65.53813687, 16.2686661, 2.400675914, 30.48759696, 4.831718051, 1.46608819, 22.5656601, 6.945828492, 7.489253059, 8.047237659], 
        [68.53955619, 16.23271726, 2.48634072, 32.12447809, 5.056451746, 1.515006639, 23.40901179, 7.586023602, 7.548470955, 8.164801928], 
        [71.63163859, 16.22368966, 2.573201896, 33.82069105, 5.294166011, 1.566090917, 24.25157386, 8.271615353, 7.612713054, 8.284053929], 
        [74.81401524, 16.24009005, 2.661258763, 35.57524173, 5.546048661, 1.619299782, 25.09285437, 9.002480751, 7.681683851, 8.40498986], 
        [78.08631727, 16.28042517, 2.750510643, 37.38713601, 5.813287515, 1.674591991, 25.93236142, 9.778496802, 7.755087846, 8.527605919], 
        [81.44817585, 16.34320178, 2.840956858, 39.25537977, 6.097070387, 1.731926299, 26.76960309, 10.59954051, 7.832629535, 8.651898304], 
        [84.89922212, 16.42692661, 2.93259673, 41.17897889, 6.398585095, 1.791261464, 27.60408745, 11.46548889, 7.914013418, 8.777863212], 
        [88.43908724, 16.53010642, 3.02542958, 43.15693925, 6.719019456, 1.852556242, 28.43532259, 12.37621893, 7.998943991, 8.905496842], 
        [92.06740236, 16.65124795, 3.119454731, 45.18826675, 7.059561286, 1.915769389, 29.2628166, 13.33160766, 8.087125753, 9.034795391], 
        [95.78379864, 16.78885796, 3.214671504, 47.27196725, 7.421398403, 1.980859662, 30.08607754, 14.33153207, 8.178263201, 9.165755057], 
        [99.58790721, 16.94144319, 3.311079221, 49.40704665, 7.805718621, 2.047785818, 30.90461351, 15.37586916, 8.272060835, 9.298372038], 
        [103.4793592, 17.10751039, 3.408677205, 51.59251082, 8.21370976, 2.116506612, 31.71793259, 16.46449596, 8.36822315, 9.432642532], 
        [107.4577859, 17.2855663, 3.507464775, 53.82736565, 8.646559634, 2.186980802, 32.52554285, 17.59728945, 8.466454646, 9.568562736], 
        [111.5228183, 17.47411768, 3.607441256, 56.11061703, 9.105456061, 2.259167145, 33.32695238, 18.77412665, 8.56645982, 9.706128848], 
        [115.6740876, 17.67167127, 3.708605967, 58.44127082, 9.591586858, 2.333024396, 34.12166927, 19.99488457, 8.66794317, 9.845337067], 
        [119.911225, 17.87673382, 3.810958232, 60.81833292, 10.10613984, 2.408511312, 34.90920158, 21.2594402, 8.770609194, 9.986183589], 
        [124.2338616, 18.08781208, 3.914497372, 63.2408092, 10.65030283, 2.48558665, 35.68905742, 22.56767056, 8.874162389, 10.12866461], 
        [128.6416286, 18.30341279, 4.019222708, 65.70770556, 11.22526363, 2.564209166, 36.46074485, 23.91945265, 8.978307255, 10.27277634], 
        [133.1341571, 18.52204271, 4.125133563, 68.21802787, 11.83221007, 2.644337617, 37.22377195, 25.31466348, 9.082748288, 10.41851496], 
        [137.7110783, 18.74220858, 4.232229259, 70.77078201, 12.47232997, 2.725930759, 37.97764682, 26.75318006, 9.187189987, 10.56587667], 
        [142.3720233, 18.96241715, 4.340509117, 73.36497387, 13.14681113, 2.808947349, 38.72187753, 28.23487938, 9.291336849, 10.71485768], 
        [147.1166232, 19.18117517, 4.449972458, 75.99960933, 13.85684138, 2.893346143, 39.45597216, 29.75963846, 9.394893372, 10.86545418], 
        [151.9445094, 19.39698938, 4.560618606, 78.67369427, 14.60360853, 2.979085899, 40.1794388, 31.3273343, 9.497564055, 11.01766237], 
        [156.8553128, 19.60836653, 4.672446881, 81.38623458, 15.3883004, 3.066125372, 40.89178552, 32.93784391, 9.599053395, 11.17147845], 
        [161.8486646, 19.81381338, 4.785456606, 84.13623613, 16.21210481, 3.154423319, 41.59252042, 34.59104429, 9.699065889, 11.32689861], 
        [166.924196, 20.01183666, 4.899647102, 86.92270482, 17.07620957, 3.243938496, 42.28115156, 36.28681245, 9.797306037, 11.48391905], 
        [172.0815382, 20.20094314, 5.015017691, 89.74464651, 17.9818025, 3.334629661, 42.95718704, 38.0250254, 9.893478336, 11.64253597], 
        [177.3203223, 20.37963954, 5.131567695, 92.6010671, 18.93007142, 3.426455569, 43.62013493, 39.80556014, 9.987287283, 11.80274557], 
        [182.6401794, 20.54643263, 5.249296436, 95.49097247, 19.92220414, 3.519374977, 44.26950331, 41.62829368, 10.07843738, 11.96454404], 
        [188.0407407, 20.69982915, 5.368203236, 98.4133685, 20.95938848, 3.613346642, 44.90480028, 43.49310303, 10.16663311, 12.12792759], 
        [193.5216374, 20.83833585, 5.488287415, 101.3672611, 22.04281226, 3.708329321, 45.5255339, 45.39986518, 10.25157899, 12.29289241], 
        [199.0825006, 20.96045947, 5.609548297, 104.3516561, 23.17366329, 3.804281769, 46.13121226, 47.34845715, 10.33297952, 12.4594347], 
        [204.7229614, 21.06470676, 5.731985203, 107.3655594, 24.35312939, 3.901162743, 46.72134345, 49.33875594, 10.41053917, 12.62755065], 
        [210.4426511, 21.14958448, 5.855597455, 110.4079768, 25.58239837, 3.998931, 47.29543554, 51.37063857, 10.48396247, 12.79723647], 
        [216.2412007, 21.21359937, 5.980384375, 113.4779144, 26.86265806, 4.097545297, 47.85299662, 53.44398202, 10.5529539, 12.96848835], 
        [222.1182414, 21.25525818, 6.106345284, 116.5743779, 28.19509627, 4.196964389, 48.39353477, 55.55866332, 10.61721796, 13.14130249], 
        [228.0734044, 21.27306765, 6.233479504, 119.6963733, 29.58090081, 4.297147034, 48.91655806, 57.71455946, 10.67645915, 13.31567509], 
        [234.1063208, 21.26553453, 6.361786357, 122.8429063, 31.02125951, 4.398051988, 49.42157459, 59.91154745, 10.73038197, 13.49160235], 
        [240.2166218, 21.23116558, 6.491265165, 126.012983, 32.51736018, 4.499638007, 49.90809243, 62.14950431, 10.77869091, 13.66908046], 
        [246.4039385, 21.16846753, 6.62191525, 129.2056092, 34.07039064, 4.601863849, 50.37561966, 64.42830703, 10.82109048, 13.84810562],
        [252.6679021, 21.07594714, 6.753735934, 132.4197907, 35.68153869, 4.704688269, 50.82366438, 66.74783262, 10.85728517, 14.02867403], 
        [259.0081437, 20.95211116, 6.886726538, 135.6545335, 37.35199217, 4.808070024, 51.25173465, 69.10795808, 10.88697947, 14.21078189]]



# GRID EMISSIONS FACTORS: REF Grid EFs kg CO2-eq per kwh									
# Emissions Factors!B11:K57
# TODO: Replace this with emissions_factors module once interface is better understood
ef_co2_eq_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [None, None, None, None, None, None, None, None, None, None],
        [0.617381628, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.613053712, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.605559021, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.599823764, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.596692109, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.592956465, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.589394210, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.585889941, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.582469966, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.579126508, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.576180724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.572640473, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.569484654, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.566378788, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.563317175, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.560425096, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.557305440, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.554345365, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.551409592, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.548493724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.545513743, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.542688056, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.539794403, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.536903541, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.533998347, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.530880184, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.528185055, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.525268472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.522337859, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.519390128, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.516316183, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.513431317, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.510414389, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.507368630, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.504753472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.503017663, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.501095098, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.499244741, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.497355610, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.495425752, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.493412239, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.491436597, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.489373931, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.487263794, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.485104746, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.483057065, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666]]

class Cluster:

    def __init__(self):
        self.name = name

    def run_cluster(self):
        scenario = cluster_model.Scenario(name, assumptions)
        scenario.load_pop_data(DATADIR)
        scenario.load_tam_mix(current_tam_mix_list)
        scenario.load_ref2_tam(ref2_tam_list)
        scenario.calc_ref1_tam()
        scenario.calc_ref2_demand()
        scenario.calc_ref1_demand()
        scenario.calc_change_demand()
        scenario.calc_addl_units_highed()
        scenario.calc_addl_units_lowed()
        scenario.calc_emis_diff_highed_comlight(ef_co2_eq_list)
        scenario.calc_emis_diff_lowed_comlight()
        scenario.calc_emis_alloc_lldc()
        scenario.calc_addl_units_mdc()
        scenario.calc_emis_diff_mdc_comlight()
        scenario.calc_emis_alloc_mdc()
        scenario.calc_total_emis()
        scenario.print_total_emis()
        return scenario
        
if __name__ == "__main__":
    cluster = Cluster()
    cluster.run_cluster()