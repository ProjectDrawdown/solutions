"""Health & Education solution model for Space Heating Cluster
   Excel filename: CORE_PopulationChange_29Jan2020 (version 1.5).xlsx
   Excel sheet name: SpaceHeating_cluster
"""
import pathlib
import numpy as np
import pandas as pd
import sys
__file__ = 'c:\\Users\\sunishchal.dev\\Documents\\solutions\\solution\\health_and_education\\clusters'
repo_path = str(pathlib.Path(__file__).parents[2])
sys.path.append(repo_path)
# sys.path.append('c:\\Users\\sunishchal.dev\\Documents\\solutions')

from model import advanced_controls as ac
from solution.health_and_education.clusters import cluster_model

DATADIR = pathlib.Path(__file__).parents[0].joinpath('data')
THISDIR = pathlib.Path(__file__).parents[0]

name = 'Health and Education - Space Heating Cluster'
solution_category = ac.SOLUTION_CATEGORY.REDUCTION 
period_start = 2020
period_end = 2050

# % impact of educational attainment on uptake of Family Planning:
assumptions = {
    'fixed_weighting_factor': None,
    'pct_impact': 0.50,
    'use_fixed_weight': 'N',
    'Twh_per_TWh': 0.198502876609453,
    'TJ_per_TWh': 2885.38964189766,
    'period_start': 2020,
    'period_end': 2050,
    'Grid': 'Y',
    'Fuel': 'Y',
    'Other Direct': 'N',
    'Indirect': 'N',
    'Weighted Emission Factor for Space Heating and Cooling': 87.04
}

# TABLE 1: Current TAM Mix
current_tam_mix_list = [
        ['Energy Source', 'Weighting Factor', 'Include in SOL?', 'Include in CONV?'],
        ['Coal', 7.0203526, 'N', 'Y'],
        ['Oil Products', 12.5061887, 'N', 'Y'],
        ['Natural Gas', 36.8500104, 'N', 'Y'],
        ['Electricity (Heating & Cooling)', 13.9625051, 'N', 'Y'],
        ['Biomass, waste and other renewables', 13.6908156, 'N', 'Y'],
        ['Commercial heat', 15.9701277, 'N', 'Y']]

# Table 2: REF2,  Heating Demand TAM (TWh Therms)										
# SpaceHeating_cluster!B28:K75
# TODO: Replace this with solarpvutil.Scenario.ref_tam_per_region once we resolve the data mismatch
ref2_tam_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [10669.16363, 2962.263488, 561.0079653, 4099.311153, 1033.924582, 434.4641223, 2772.465626, 797.2777074, 1198.774588, 1260.245688],
        [10860.45764, 2984.777619, 566.1629708, 4189.758885, 1064.708058, 442.1809161, 2824.584893, 823.1330498, 1204.604657, 1271.71414],
        [11054.07522, 3006.994636, 571.2518042, 4281.946446, 1095.859513, 449.9415929, 2875.983506, 850.7394459, 1210.527168, 1283.255696],
        [11249.9193, 3028.903646, 576.2808696, 4375.819879, 1127.408863, 457.7401269, 2926.656272, 880.0766113, 1216.503086, 1294.851176],
        [11447.85329, 3050.518088, 581.2545152, 4471.273281, 1159.400951, 465.5719961, 2976.542878, 911.1169801, 1222.488913, 1306.494931],
        [11647.69453, 3071.858542, 586.1873931, 4568.168642, 1191.884575, 473.4306054, 3025.556955, 943.8184722, 1228.409726, 1318.17211],
        [11848.15994, 3092.900285, 591.1791084, 4665.706889, 1225.053698, 481.3111757, 3073.026365, 978.3222086, 1234.013548, 1329.895139],
        [12052.64645, 3113.774383, 595.9626869, 4765.900232, 1258.503962, 489.2094645, 3120.759701, 1014.084803, 1239.883083, 1341.58984],
        [12257.73481, 3134.356149, 600.7963627, 4866.672475, 1292.714626, 497.1271089, 3166.950136, 1051.632479, 1245.449322, 1353.332521],
        [12464.6224, 3154.714587, 605.5935275, 4968.718231, 1327.563826, 505.0619398, 3212.23334, 1090.784133, 1250.910859, 1365.07968],
        [12673.39373, 3174.881829, 610.3567937, 5072.065596, 1363.073546, 513.012908, 3256.653314, 1131.539129, 1256.274807, 1376.807614],
        [12884.11668, 3194.881054, 615.0890579, 5176.731785, 1399.270201, 520.9789974, 3300.247431, 1173.894469, 1261.546561, 1388.497797],
        [13096.80468, 3214.72315, 619.7932289, 5282.698862, 1436.188087, 528.9585259, 3343.027382, 1217.841, 1266.723557, 1400.143012],
        [13311.45249, 3234.402998, 624.4726371, 5389.935163, 1473.869338, 536.9500847, 3384.998075, 1263.364988, 1271.802289, 1411.742722],
        [13528.09117, 3253.907199, 629.1314784, 5498.430402, 1512.357844, 544.9534103, 3426.184667, 1310.453806, 1276.786873, 1423.293563],
        [13746.75521, 3273.213503, 633.7744739, 5608.175218, 1551.701042, 552.9686719, 3466.615811, 1359.093319, 1281.683167, 1434.79424],
        [13971.9491, 3292.390266, 638.053238, 5721.918144, 1591.349987, 560.9930396, 3508.75491, 1408.566408, 1286.894576, 1446.142712],
        [14190.27602, 3311.174195, 643.0320742, 5831.36716, 1633.126714, 569.0338571, 3545.307406, 1460.97425, 1291.225014, 1457.639364],
        [14415.17514, 3329.824826, 647.656042, 5944.785154, 1675.285106, 577.0817327, 3583.600794, 1514.196034, 1295.870522, 1468.97893],
        [14642.20161, 3348.242855, 652.2888431, 6059.393256, 1718.465208, 585.1376728, 3621.224618, 1568.921609, 1300.429359, 1480.269195],
        [14871.38455, 3366.413457, 656.9426803, 6175.170142, 1762.714121, 593.1996654, 3658.207777, 1625.136111, 1304.897574, 1491.519608],
        [15102.74903, 3384.324713, 661.6279528, 6292.095814, 1808.075896, 601.2659534, 3694.574087, 1682.826471, 1309.272086, 1502.737112],
        [15336.31214, 3401.969054, 666.3503069, 6410.150194, 1854.591022, 609.3353268, 3730.340463, 1741.98062, 1313.551724, 1513.925191],
        [15572.08689, 3419.344084, 671.1134905, 6529.317587, 1902.294507, 617.4070325, 3765.515157, 1802.590867, 1317.736931, 1525.082311],
        [15810.08796, 3436.449856, 675.9235657, 6649.587315, 1951.217749, 625.4803545, 3800.101579, 1864.654186, 1321.827998, 1536.204555],
        [16050.32816, 3453.289193, 680.7863807, 6770.951439, 2001.389021, 633.5547512, 3834.0979, 1928.170696, 1325.825784, 1547.285665],
        [16286.29506, 3469.862659, 686.2369991, 6889.258302, 2053.730237, 641.6336083, 3863.847504, 1994.19394, 1329.711906, 1558.47401],
        [16537.56396, 3486.173485, 690.688332, 7016.908861, 2105.600641, 649.7038274, 3900.317765, 2059.551319, 1333.543201, 1569.313365],
        [16784.57163, 3502.215212, 695.7334016, 7141.458995, 2159.712993, 657.7763607, 3932.546349, 2127.399169, 1337.262436, 1580.264572],
        [17033.83213, 3517.984858, 700.8416851, 7267.018811, 2215.20843, 665.8465514, 3964.192994, 2196.671574, 1340.885636, 1591.181322],
        [17285.33164, 3533.477251, 706.0114844, 7393.554359, 2272.119763, 673.9138876, 3995.262365, 2267.356425, 1344.40912, 1602.071415],
        [17539.05835, 3548.689557, 711.2413017, 7521.032805, 2330.48056, 681.9776399, 4025.754655, 2339.442569, 1347.830621, 1612.941462],
        [17795.01029, 3563.619741, 716.5321219, 7649.427184, 2390.325464, 690.0368663, 4055.667963, 2412.92004, 1351.149896, 1623.795095],
        [18053.18648, 3578.271572, 721.8842157, 7778.711445, 2451.690337, 698.0902408, 4084.990695, 2487.78147, 1354.368961, 1634.634349],
        [18313.57633, 3592.655346, 727.2940475, 7908.853586, 2514.611647, 706.1361489, 4113.699985, 2564.021224, 1357.490685, 1645.462527],
        [18576.16702, 3606.785472, 732.7566487, 8039.819845, 2579.126543, 714.172712, 4141.765459, 2641.635063, 1360.519195, 1656.282738],
        [18845.17104, 3620.588027, 737.9144873, 8174.336365, 2644.677361, 722.1954336, 4171.596905, 2719.913456, 1363.084177, 1666.996881],
        [19107.92511, 3634.322763, 743.8273091, 8304.099366, 2713.084723, 730.2108719, 4195.879841, 2800.95966, 1366.310734, 1677.910946],
        [19377.09809, 3647.733841, 749.43452, 8437.358364, 2782.600793, 738.2096128, 4221.91617, 2882.651414, 1369.078467, 1688.724161],
        [19648.44524, 3660.9069, 755.0880696, 8571.308789, 2853.85634, 746.1926503, 4247.229288, 2965.678312, 1371.764545, 1699.544907],
        [19921.93821, 3673.840762, 760.7863521, 8705.900227, 2926.887373, 754.1582278, 4271.770235, 3050.024009, 1374.37211, 1710.38148],
        [20197.56249, 3686.534507, 766.5284428, 8841.090646, 3001.730436, 762.1046269, 4295.505775, 3135.673485, 1376.904483, 1721.239773],
        [20475.3211, 3698.990161, 772.3147168, 8976.850087, 3078.422798, 770.0302978, 4318.422143, 3222.616037, 1379.365341, 1732.122165],
        [20755.24068, 3711.20916, 778.1462425, 9113.163507, 3157.002469, 777.9336692, 4340.534932, 3310.842454, 1381.758463, 1743.027312],
        [21037.36197, 3723.188971, 784.0240031, 9250.023481, 3237.507833, 785.8129791, 4361.879019, 3400.340865, 1384.087554, 1753.952381],
        [21321.73945, 3734.925729, 789.9493625, 9387.431319, 3319.977713, 793.6664151, 4382.507333, 3491.099347, 1386.356311, 1764.892536],
        [21607.39916, 3746.459569, 796.0128216, 9524.696407, 3404.599666, 801.4929156, 4401.857177, 3583.282817, 1388.758975, 1775.868678]]


# GRID EMISSIONS FACTORS: REF Grid EFs kg CO2-eq per kwh									
# Emissions Factors!B11:K57
# TODO: Replace this with emissions_factors module once interface is better understood
ef_co2_eq_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [None, None, None, None, None, None, None, None, None, None],
        [0.617381628, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.613053712, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.605559021, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.599823764, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.596692109, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.592956465, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.589394210, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.585889941, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.582469966, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.579126508, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.576180724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.572640473, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.569484654, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.566378788, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.563317175, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.560425096, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.557305440, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.554345365, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.551409592, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.548493724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.545513743, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.542688056, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.539794403, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.536903541, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.533998347, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.530880184, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.528185055, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.525268472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.522337859, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.519390128, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.516316183, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.513431317, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.510414389, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.507368630, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.504753472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.503017663, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.501095098, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.499244741, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.497355610, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.495425752, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.493412239, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.491436597, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.489373931, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.487263794, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.485104746, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.483057065, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666]]

class Cluster:

    def __init__(self):
        self.name = name

    def run_cluster(self):
        scenario = cluster_model.Scenario(name, assumptions)
        scenario.load_pop_data(DATADIR)
        scenario.load_tam_mix(current_tam_mix_list)
        scenario.load_ref2_tam(ref2_tam_list)
        scenario.calc_ref1_tam()
        scenario.calc_ref2_demand()
        scenario.calc_ref1_demand()
        scenario.calc_change_demand()
        scenario.calc_addl_units_highed()
        scenario.calc_addl_units_lowed()
        scenario.calc_emis_diff_highed_spaceheating(ef_co2_eq_list)
        scenario.calc_emis_diff_lowed_spaceheating()
        scenario.calc_emis_alloc_lldc()
        scenario.calc_addl_units_mdc()
        scenario.calc_emis_diff_mdc_spaceheating()
        scenario.calc_emis_alloc_mdc()
        scenario.calc_total_emis()
        scenario.print_total_emis()
        return scenario
        
if __name__ == "__main__":
    cluster = Cluster()
    cluster.run_cluster()