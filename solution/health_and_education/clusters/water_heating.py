"""Health & Education solution model for Water Heating Cluster
   Excel filename: CORE_PopulationChange_29Jan2020 (version 1.5).xlsx
   Excel sheet name: WaterHeating_cluster
"""
import pathlib
import numpy as np
import pandas as pd
import sys
__file__ = 'c:\\Users\\sunishchal.dev\\Documents\\solutions\\solution\\health_and_education\\clusters'
repo_path = str(pathlib.Path(__file__).parents[2])
sys.path.append(repo_path)
# sys.path.append('c:\\Users\\sunishchal.dev\\Documents\\solutions')

from model import advanced_controls as ac
from solution.health_and_education.clusters import cluster_model

DATADIR = pathlib.Path(__file__).parents[0].joinpath('data')
THISDIR = pathlib.Path(__file__).parents[0]

name = 'Health and Education - Water Heating Cluster'
solution_category = ac.SOLUTION_CATEGORY.REDUCTION 
period_start = 2020
period_end = 2050

# % impact of educational attainment on uptake of Family Planning:
assumptions = {
    'fixed_weighting_factor': None,
    'pct_impact': 0.50,
    'use_fixed_weight': 'N',
    'Twh_per_TWh': 0.258076042718495,
    'TJ_per_TWh': 4559.9356816308,
    'period_start': 2020,
    'period_end': 2050,
    'Grid': 'Y',
    'Fuel': 'Y',
    'Other Direct': 'N',
    'Indirect': 'N',
    'Weighted Emission Factor for Space Heating and Cooling': 87.04
}

# TABLE 1: Current TAM Mix
current_tam_mix_list = [
        ['Energy Source', 'Weighting Factor', 'Include in SOL?', 'Include in CONV?'],
        ['Coal', 1.5, 'N', 'Y'],
        ['Oil Products', 15.1, 'N', 'Y'],
        ['Natural Gas', 25.8, 'N', 'Y'],
        ['Electricity (Heating & Cooling)', 13.4, 'N', 'Y'],
        ['Biomass, waste and other renewables', 31.6, 'N', 'N'],
        ['Commercial heat', 5.5, 'N', 'Y']]

# Table 2: REF2, Water Heating Demand TAM (TWh Therms)										
# WaterHeating_cluster!B28:K75
# TODO: Replace this with solarpvutil.Scenario.ref_tam_per_region once we resolve the data mismatch
ref2_tam_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [4732.065320, 1553.606719, 515.638146, 969.592015, 266.192644, 322.436500, 738.300606, 386.782947, 595.845608, 588.813575],
        [4770.336061, 1562.240857, 518.140272, 999.274608, 274.624745, 328.730412, 750.797283, 390.073869, 599.085377, 594.244396],
        [4811.547178, 1567.991775, 520.942358, 1021.636272, 282.111567, 333.985407, 760.243168, 394.954269, 601.559342, 598.476773],
        [4851.724970, 1573.437489, 523.710128, 1044.200475, 289.639594, 339.217275, 769.422403, 399.508301, 603.868475, 602.507651],
        [4890.882691, 1578.589771, 526.443977, 1066.963026, 297.208102, 344.425432, 778.334189, 403.748024, 606.018663, 606.344349],
        [4929.033600, 1583.460391, 529.144299, 1089.919741, 304.816368, 349.609291, 786.977729, 407.685494, 608.015793, 609.994188],
        [4966.190950, 1588.061119, 531.811490, 1113.066430, 312.463666, 354.768266, 795.352221, 411.332766, 609.865750, 613.464485],
        [5002.367998, 1592.403728, 534.445943, 1136.398907, 320.149274, 359.901771, 803.456869, 414.701898, 611.574422, 616.762562],
        [5037.577999, 1596.499986, 537.048054, 1159.912984, 327.872467, 365.009220, 811.290873, 417.804945, 613.147695, 619.895737],
        [5071.834210, 1600.361665, 539.618217, 1183.604474, 335.632522, 370.090028, 818.853435, 420.653965, 614.591456, 622.871329],
        [5105.149887, 1604.000536, 542.156827, 1207.469189, 343.428714, 375.143607, 826.143755, 423.261013, 615.911592, 625.696660],
        [5137.538284, 1607.428370, 544.664279, 1231.502942, 351.260319, 380.169373, 833.161034, 425.638146, 617.113989, 628.379046],
        [5169.012659, 1610.656936, 547.140967, 1255.701546, 359.126615, 385.166738, 839.904475, 427.797422, 618.204535, 630.925810],
        [5199.586266, 1613.698006, 549.587286, 1280.060812, 367.026876, 390.135117, 846.373277, 429.750895, 619.189115, 633.344269],
        [5229.272362, 1616.563351, 552.003631, 1304.576554, 374.960379, 395.073925, 852.566643, 431.510622, 620.073616, 635.641743],
        [5258.084202, 1619.264741, 554.390397, 1329.244584, 382.926400, 399.982574, 858.483773, 433.088660, 620.863926, 637.825553],
        [5286.035043, 1621.813947, 556.747978, 1354.060715, 390.924214, 404.860479, 864.123869, 434.497066, 621.565930, 639.903016],
        [5313.138140, 1624.222740, 559.076769, 1379.020760, 398.953099, 409.707054, 869.486132, 435.747895, 622.185516, 641.881454],
        [5339.406748, 1626.502890, 561.377165, 1404.120530, 407.012330, 414.521713, 874.569762, 436.853205, 622.728571, 643.768185],
        [5364.854125, 1628.666169, 563.649560, 1429.355838, 415.101183, 419.303869, 879.373962, 437.825051, 623.200980, 645.570529],
        [5389.493525, 1630.724346, 565.894350, 1454.722498, 423.218934, 424.052938, 883.897933, 438.675491, 623.608630, 647.295805],
        [5413.338204, 1632.689193, 568.111928, 1480.216321, 431.364859, 428.768332, 888.140874, 439.416580, 623.957409, 648.951333],
        [5436.401419, 1634.572480, 570.302690, 1505.833121, 439.538235, 433.449466, 892.101989, 440.060374, 624.253203, 650.544432],
        [5458.696424, 1636.385978, 572.467030, 1531.568709, 447.738337, 438.095754, 895.780477, 440.618932, 624.501899, 652.082422],
        [5480.236477, 1638.141458, 574.605343, 1557.418899, 455.964442, 442.706609, 899.175541, 441.104308, 624.709382, 653.572623],
        [5501.034832, 1639.850690, 576.718024, 1583.379502, 464.215825, 447.281446, 902.286380, 441.528559, 624.881541, 655.022353],
        [5521.104746, 1641.525446, 578.805467, 1609.446332, 472.491763, 451.819679, 905.112198, 441.903742, 625.024262, 656.438933],
        [5540.459474, 1643.177495, 580.868068, 1635.615201, 480.791531, 456.320721, 907.652193, 442.241913, 625.143431, 657.829681],
        [5559.112272, 1644.818609, 582.906220, 1661.881922, 489.114406, 460.783987, 909.905569, 442.555129, 625.244934, 659.201918],
        [5577.076396, 1646.460559, 584.920320, 1688.242306, 497.459664, 465.208891, 911.871526, 442.855446, 625.334660, 660.562963],
        [5594.365102, 1648.115114, 586.910760, 1714.692168, 505.826582, 469.594846, 913.549265, 443.154920, 625.418494, 661.920135],
        [5610.991645, 1649.794046, 588.877936, 1741.227319, 514.214434, 473.941266, 914.937987, 443.465609, 625.502323, 663.280754],
        [5626.969282, 1651.509126, 590.822243, 1767.843572, 522.622497, 478.247566, 916.036894, 443.799567, 625.592034, 664.652139],
        [5642.311269, 1653.272124, 592.744076, 1794.536739, 531.050047, 482.513160, 916.845187, 444.168853, 625.693514, 666.041611],
        [5657.030860, 1655.094811, 594.643829, 1821.302634, 539.496360, 486.737461, 917.362066, 444.585521, 625.812649, 667.456487],
        [5671.141313, 1656.988958, 596.521897, 1848.137068, 547.960713, 490.919883, 917.586734, 445.061630, 625.955325, 668.904088],
        [5684.655882, 1658.966335, 598.378674, 1875.035854, 556.442381, 495.059841, 917.518391, 445.609234, 626.127430, 670.391734],
        [5697.587823, 1661.038713, 600.214556, 1901.994805, 564.940640, 499.156748, 917.156238, 446.240391, 626.334851, 671.926744],
        [5709.950394, 1663.217863, 602.029936, 1929.009734, 573.454767, 503.210018, 916.499477, 446.967157, 626.583473, 673.516436],
        [5721.756848, 1665.515555, 603.825211, 1956.076452, 581.984037, 507.219066, 915.547309, 447.801589, 626.879184, 675.168132],
        [5733.020442, 1667.943561, 605.600774, 1983.190773, 590.527727, 511.183305, 914.298935, 448.755742, 627.227870, 676.889150],
        [5743.754433, 1670.513651, 607.357020, 2010.348509, 599.085113, 515.102150, 912.753556, 449.841674, 627.635418, 678.686810],
        [5753.972075, 1673.237595, 609.094344, 2037.545473, 607.655470, 518.975013, 910.910374, 451.071440, 628.107715, 680.568431],
        [5763.686624, 1676.127165, 610.813141, 2064.777477, 616.238075, 522.801310, 908.768589, 452.457098, 628.650647, 682.541333],
        [5772.911337, 1679.194131, 612.513805, 2092.040334, 624.832204, 526.580454, 906.327403, 454.010703, 629.270101, 684.612836],
        [5781.659469, 1682.450264, 614.196732, 2119.329856, 633.437133, 530.311860, 903.586017, 455.744312, 629.971964, 686.790258],
        [5789.944276, 1685.907334, 615.862315, 2146.641856, 642.052138, 533.994940, 900.543632, 457.669982, 630.762122, 689.080919]]



# GRID EMISSIONS FACTORS: REF Grid EFs kg CO2-eq per kwh									
# Emissions Factors!B11:K57
# TODO: Replace this with emissions_factors module once interface is better understood
ef_co2_eq_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [None, None, None, None, None, None, None, None, None, None],
        [0.617381628, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.613053712, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.605559021, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.599823764, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.596692109, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.592956465, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.589394210, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.585889941, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.582469966, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.579126508, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.576180724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.572640473, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.569484654, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.566378788, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.563317175, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.560425096, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.557305440, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.554345365, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.551409592, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.548493724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.545513743, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.542688056, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.539794403, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.536903541, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.533998347, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.530880184, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.528185055, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.525268472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.522337859, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.519390128, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.516316183, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.513431317, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.510414389, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.507368630, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.504753472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.503017663, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.501095098, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.499244741, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.497355610, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.495425752, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.493412239, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.491436597, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.489373931, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.487263794, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.485104746, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.483057065, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666]]

class Cluster:

    def __init__(self):
        self.name = name

    def run_cluster(self):
        scenario = cluster_model.Scenario(name, assumptions)
        scenario.load_pop_data(DATADIR)
        scenario.load_tam_mix(current_tam_mix_list)
        scenario.load_ref2_tam(ref2_tam_list)
        scenario.calc_ref1_tam()
        scenario.calc_ref2_demand()
        scenario.calc_ref1_demand()
        scenario.calc_change_demand()
        scenario.calc_addl_units_highed()
        scenario.calc_addl_units_lowed()
        scenario.calc_emis_diff_highed_waterheating(ef_co2_eq_list)
        scenario.calc_emis_diff_lowed_waterheating()
        scenario.calc_emis_alloc_lldc()
        scenario.calc_addl_units_mdc()
        scenario.calc_emis_diff_mdc_waterheating()
        scenario.calc_emis_alloc_mdc()
        scenario.calc_total_emis()
        scenario.print_total_emis()
        return scenario
        
if __name__ == "__main__":
    cluster = Cluster()
    cluster.run_cluster()