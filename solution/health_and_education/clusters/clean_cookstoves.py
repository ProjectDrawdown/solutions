"""Health & Education solution model for Clean Cookstoves Cluster
   Excel filename: CORE_PopulationChange_29Jan2020 (version 1.5).xlsx
   Excel sheet name: CleanCookstoves_cluster
"""
import pathlib
import numpy as np
import pandas as pd
import sys
__file__ = 'c:\\Users\\sunishchal.dev\\Documents\\solutions\\solution\\health_and_education\\clusters'
repo_path = str(pathlib.Path(__file__).parents[2])
sys.path.append(repo_path)
# sys.path.append('c:\\Users\\sunishchal.dev\\Documents\\solutions')

from model import advanced_controls as ac
from solution.health_and_education.clusters import cluster_model

DATADIR = pathlib.Path(__file__).parents[0].joinpath('data')
THISDIR = pathlib.Path(__file__).parents[0]

name = 'Health and Education - Clean Cookstoves Cluster'
solution_category = ac.SOLUTION_CATEGORY.REDUCTION 
period_start = 2020
period_end = 2050

# % impact of educational attainment on uptake of Family Planning:
assumptions = {
    'fixed_weighting_factor': None,
    'pct_impact': 0.50,
    'use_fixed_weight': 'N',
    'TJ_per_TWh': 16997.5625998504,
    'period_start': 2020,
    'period_end': 2050,
    'Grid': 'N',
    'Fuel': 'Y',
    'Other Direct': 'N',
    'Indirect': 'N',
    'CO2-eq Emissions for Solid Biofuels': 108.0
}

# TABLE 1: Current TAM Mix
current_tam_mix_list = [
        ['Energy Source', 'Weighting Factor', 'Include in SOL?', 'Include in CONV?'],
        ['LPG', 23.7722604650757, 'N', 'N'],
        ['Electricity', 3.09086628733514, 'N', 'N'],
        ['Firewood (incl crop residue+dung)', 44.5074639589554, 'N', 'Y'],
        ['Biogas', 1.00127286339017, 'N', 'N'],
        ['Coal', 15.3972560062807, 'N', 'N'],
        ['Natural Gas', 2.92055789748195, 'N', 'N'],
        ['Kerosene', 2.30072086818361, 'N', 'N'],
        ['Coal gas', 2.92055789748195, 'N', 'N']]

# Table 2: REF2,  Heating Demand TAM (TWh Therms)										
# Clean Cookstoves_cluster!B28:K75
# TODO: Replace this with solarpvutil.Scenario.ref_tam_per_region once we resolve the data mismatch
ref2_tam_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [4417.454144, 0.000000, 0.000000, 4053.298731, 1783.757754, 173.254108, 1086.492157, 1622.370389, 0.000000, 0.000000],
        [4499.784719, 0.000000, 0.000000, 4063.458970, 1813.714359, 173.110086, 1083.167749, 1629.340849, 0.000000, 0.000000],
        [4566.459576, 0.000000, 0.000000, 4072.722322, 1846.401375, 173.132753, 1079.291643, 1640.767842, 0.000000, 0.000000],
        [4640.619484, 0.000000, 0.000000, 4081.370608, 1879.220242, 173.127819, 1074.656400, 1651.913008, 0.000000, 0.000000],
        [4714.592064, 0.000000, 0.000000, 4089.403674, 1912.166934, 173.095459, 1069.301088, 1662.775487, 0.000000, 0.000000],
        [4788.429020, 0.000000, 0.000000, 4096.821366, 1945.237426, 173.035847, 1063.264772, 1673.354415, 0.000000, 0.000000],
        [4857.017901, 0.000000, 0.000000, 4103.623531, 1978.427692, 172.949155, 1056.586516, 1683.648933, 0.000000, 0.000000],
        [4928.700426, 0.000000, 0.000000, 4109.810015, 2011.733707, 172.835559, 1049.305389, 1693.658179, 0.000000, 0.000000],
        [4995.148726, 0.000000, 0.000000, 4115.380664, 2045.151444, 172.695231, 1041.460454, 1703.381292, 0.000000, 0.000000],
        [5061.464606, 0.000000, 0.000000, 4120.335323, 2078.676878, 172.528346, 1033.090778, 1712.817409, 0.000000, 0.000000],
        [5127.597848, 0.000000, 0.000000, 4124.673841, 2112.305984, 172.335078, 1024.235427, 1721.965671, 0.000000, 0.000000],
        [5193.508617, 0.000000, 0.000000, 4128.396061, 2146.034735, 172.115601, 1014.933467, 1730.825215, 0.000000, 0.000000],
        [5259.177960, 0.000000, 0.000000, 4131.501832, 2179.859107, 171.870088, 1005.223962, 1739.395180, 0.000000, 0.000000],
        [5324.597693, 0.000000, 0.000000, 4133.990998, 2213.775072, 171.598714, 995.145980, 1747.674706, 0.000000, 0.000000],
        [5389.752123, 0.000000, 0.000000, 4135.863407, 2247.778607, 171.301651, 984.738586, 1755.662930, 0.000000, 0.000000],
        [5454.627086, 0.000000, 0.000000, 4137.118904, 2281.865684, 170.979075, 974.040846, 1763.358992, 0.000000, 0.000000],
        [5519.206321, 0.000000, 0.000000, 4137.757336, 2316.032279, 170.631159, 963.091825, 1770.762029, 0.000000, 0.000000],
        [5575.316947, 0.000000, 0.000000, 4137.778548, 2350.274365, 170.258076, 951.930590, 1777.871181, 0.000000, 0.000000],
        [5631.178821, 0.000000, 0.000000, 4137.182387, 2384.587918, 169.860002, 940.596206, 1784.685587, 0.000000, 0.000000],
        [5686.782132, 0.000000, 0.000000, 4135.968699, 2418.968910, 169.437109, 929.127739, 1791.204385, 0.000000, 0.000000],
        [5742.117705, 0.000000, 0.000000, 4134.137331, 2453.413318, 168.989571, 917.564254, 1797.426713, 0.000000, 0.000000],
        [5797.172386, 0.000000, 0.000000, 4131.688128, 2487.917114, 168.517563, 905.944819, 1803.351712, 0.000000, 0.000000],
        [5851.928792, 0.000000, 0.000000, 4128.620937, 2522.476274, 168.021258, 894.308497, 1808.978518, 0.000000, 0.000000],
        [5906.363303, 0.000000, 0.000000, 4124.935604, 2557.086772, 167.500830, 882.694356, 1814.306271, 0.000000, 0.000000],
        [5960.447861, 0.000000, 0.000000, 4120.631976, 2591.744581, 166.956453, 871.141461, 1819.334109, 0.000000, 0.000000],
        [6014.150757, 0.000000, 0.000000, 4115.709897, 2626.445677, 166.388301, 859.688878, 1824.061172, 0.000000, 0.000000],
        [6067.440852, 0.000000, 0.000000, 4110.169215, 2661.186034, 165.796548, 848.375673, 1828.486598, 0.000000, 0.000000],
        [6111.834509, 0.000000, 0.000000, 4104.009776, 2695.961626, 165.181368, 837.240910, 1832.609525, 0.000000, 0.000000],
        [6155.906047, 0.000000, 0.000000, 4097.231425, 2730.768427, 164.542934, 826.323658, 1836.429093, 0.000000, 0.000000],
        [6199.636056, 0.000000, 0.000000, 4089.834010, 2765.602412, 163.881420, 815.662980, 1839.944439, 0.000000, 0.000000],
        [6243.003700, 0.000000, 0.000000, 4081.817376, 2800.459554, 163.197001, 805.297943, 1843.154704, 0.000000, 0.000000],
        [6285.986042, 0.000000, 0.000000, 4073.181370, 2835.335830, 162.489849, 795.267613, 1846.059024, 0.000000, 0.000000],
        [6328.557075, 0.000000, 0.000000, 4063.925837, 2870.227211, 161.760140, 785.611056, 1848.656540, 0.000000, 0.000000],
        [6370.689262, 0.000000, 0.000000, 4054.050624, 2905.129674, 161.008047, 776.367336, 1850.946389, 0.000000, 0.000000],
        [6412.354174, 0.000000, 0.000000, 4043.555577, 2940.039192, 160.233743, 767.575521, 1852.927710, 0.000000, 0.000000],
        [6453.521053, 0.000000, 0.000000, 4032.440543, 2974.951740, 159.437403, 759.274676, 1854.599643, 0.000000, 0.000000],
        [6494.155356, 0.000000, 0.000000, 4020.705367, 3009.863292, 158.619201, 751.503867, 1855.961325, 0.000000, 0.000000],
        [6526.721591, 0.000000, 0.000000, 4008.349896, 3044.769823, 157.779310, 744.302159, 1857.011896, 0.000000, 0.000000],
        [6558.862251, 0.000000, 0.000000, 3995.373976, 3079.667306, 156.917904, 737.708618, 1857.750494, 0.000000, 0.000000],
        [6590.546779, 0.000000, 0.000000, 3981.777453, 3114.551716, 156.035158, 731.762311, 1858.176258, 0.000000, 0.000000],
        [6621.741211, 0.000000, 0.000000, 3967.560173, 3149.419027, 155.131245, 726.502302, 1858.288326, 0.000000, 0.000000],
        [6652.409150, 0.000000, 0.000000, 3952.721983, 3184.265214, 154.206338, 721.967659, 1858.085838, 0.000000, 0.000000],
        [6682.513018, 0.000000, 0.000000, 3937.262728, 3219.086252, 153.260612, 718.197446, 1857.567931, 0.000000, 0.000000],
        [6712.014512, 0.000000, 0.000000, 3921.182255, 3253.878113, 152.294241, 715.230729, 1856.733745, 0.000000, 0.000000],
        [6740.874312, 0.000000, 0.000000, 3904.480411, 3288.636773, 151.307399, 713.106575, 1855.582418, 0.000000, 0.000000],
        [6769.053409, 0.000000, 0.000000, 3887.157041, 3323.358207, 150.300259, 711.864048, 1854.113089, 0.000000, 0.000000],
        [6796.513173, 0.000000, 0.000000, 3869.211991, 3358.038387, 149.272995, 711.542216, 1852.324897, 0.000000, 0.000000]]

# GRID EMISSIONS FACTORS: REF Grid EFs kg CO2-eq per kwh									
# Emissions Factors!B11:K57
# TODO: Replace this with emissions_factors module once interface is better understood
ef_co2_eq_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [None, None, None, None, None, None, None, None, None, None],
        [0.617381628, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.613053712, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.605559021, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.599823764, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.596692109, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.592956465, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.589394210, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.585889941, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.582469966, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.579126508, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.576180724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.572640473, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.569484654, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.566378788, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.563317175, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.560425096, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.557305440, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.554345365, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.551409592, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.548493724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.545513743, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.542688056, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.539794403, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.536903541, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.533998347, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.530880184, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.528185055, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.525268472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.522337859, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.519390128, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.516316183, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.513431317, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.510414389, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.507368630, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.504753472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.503017663, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.501095098, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.499244741, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.497355610, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.495425752, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.493412239, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.491436597, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.489373931, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.487263794, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.485104746, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.483057065, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666]]

class Cluster:

    def __init__(self):
        self.name = name

    def run_cluster(self):
        scenario = cluster_model.Scenario(name, assumptions)
        scenario.load_pop_data(DATADIR)
        scenario.load_tam_mix(current_tam_mix_list)
        scenario.load_ref2_tam(ref2_tam_list)
        scenario.calc_ref1_tam()
        scenario.calc_ref2_demand()
        scenario.calc_ref1_demand()
        scenario.calc_change_demand()
        scenario.calc_addl_units_highed()
        scenario.calc_addl_units_lowed()
        scenario.calc_emis_diff_highed_cleancookstoves()
        scenario.calc_emis_diff_lowed_cleancookstoves()
        scenario.calc_emis_alloc_lldc()
        scenario.calc_total_emis(mdc=False)
        scenario.print_total_emis(mdc=False)
        return scenario
        
if __name__ == "__main__":
    cluster = Cluster()
    cluster.run_cluster()