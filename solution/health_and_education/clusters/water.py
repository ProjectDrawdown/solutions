"""Health & Education solution model for Water Cluster
   Excel filename: CORE_PopulationChange_29Jan2020 (version 1.5).xlsx
   Excel sheet name: Water_cluster
"""
import pathlib
import numpy as np
import pandas as pd
import sys
__file__ = 'c:\\Users\\sunishchal.dev\\Documents\\solutions\\solution\\health_and_education\\clusters'
repo_path = str(pathlib.Path(__file__).parents[2])
sys.path.append(repo_path)
# sys.path.append('c:\\Users\\sunishchal.dev\\Documents\\solutions')

from model import advanced_controls as ac
from solution.health_and_education.clusters import cluster_model

DATADIR = pathlib.Path(__file__).parents[0].joinpath('data')
THISDIR = pathlib.Path(__file__).parents[0]

name = 'Health and Education - Water Cluster'
solution_category = ac.SOLUTION_CATEGORY.REDUCTION 
period_start = 2020
period_end = 2050

# % impact of educational attainment on uptake of Family Planning:
assumptions = {
    'fixed_weighting_factor': None,
    'pct_impact': 0.50,
    'use_fixed_weight': 'N',
    'Twh_per_mm3_water_produced': 0.00127,
    'period_start': 2020,
    'period_end': 2050,
    'Grid': 'Y',
    'Fuel': 'N',
    'Other Direct': 'N',
    'Indirect': 'N'
}

# TABLE 1: Current TAM Mix
current_tam_mix_list = [
        ['Energy Source', 'Weighting Factor', 'Include in SOL?', 'Include in CONV?'],
        ['No ALC or Pressure Management', 85.0, 'N', 'Y']]

# Table 2: REF2,  Water Demand TAM (TWh Therms)										
# SpaceCooling_cluster!B28:K75
# TODO: Replace this with solarpvutil.Scenario.ref_tam_per_region once we resolve the data mismatch
ref2_tam_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [438696.450125, 137774.083575, 40458.669774, 168421.147393, 37663.600616, 62060.414564, 46977.096436, 22776.645123, 67712.398314, 73092.90083], 
        [449459.895364, 140001.898905, 41491.645606, 173450.743278, 38783.889227, 63482.802912, 50301.46851, 24025.852653, 68179.108035, 73714.670488], 
        [460420.482029, 142550.343661, 42450.962353, 178659.645751, 39758.115609, 65041.38565, 53610.501861, 25227.205309, 68961.173166, 74873.306643], 
        [471539.842987, 145123.808735, 43411.942306, 183928.708223, 40758.241949, 66633.219061, 56813.098606, 26485.338054, 69728.984867, 76024.492709], 
        [482822.415743, 147723.567586, 44375.397639, 189259.281084, 41784.915485, 68258.054042, 59911.17343, 27798.722772, 70482.718803, 77168.310436], 
        [494272.637805, 150350.893671, 45342.140524, 194652.714726, 42838.783455, 69915.641488, 62906.641016, 29165.831349, 71222.550638, 78304.84157], 
        [505894.94668, 153007.060446, 46312.983134, 200110.359541, 43920.493096, 71605.732295, 65801.416051, 30585.135671, 71948.656036, 79434.16786], 
        [517693.779873, 155693.341369, 47288.737644, 205633.565918, 45030.691644, 73328.077359, 68597.413218, 32055.107621, 72661.210661, 80556.371052], 
        [529673.574893, 158411.009898, 48270.216227, 211223.684251, 46170.026339, 75082.427575, 71296.547201, 33574.219086, 73360.390179, 81671.532895], 
        [541838.769246, 161161.339488, 49258.231054, 216882.06493, 47339.144417, 76868.533841, 73900.732687, 35140.94195, 74046.370252, 82779.735137], 
        [554193.800438, 163945.603598, 50253.594301, 222610.058347, 48538.693116, 78686.147051, 76411.884359, 36753.748099, 74719.326546, 83881.059526], 
        [566743.105978, 166765.075685, 51257.11814, 228409.014893, 49769.319672, 80535.018102, 78831.916901, 38411.109417, 75379.434724, 84975.587808], 
        [579491.12337, 169621.029205, 52269.614744, 234280.284959, 51031.671324, 82414.89789, 81162.745, 40111.49779, 76026.870452, 86063.401733], 
        [592442.290123, 172514.737617, 53291.896287, 240225.218937, 52326.395309, 84325.537309, 83406.283339, 41853.385103, 76661.809393, 87144.583047], 
        [605601.043744, 175447.474377, 54324.774942, 246245.167218, 53654.138865, 86266.687257, 85564.446602, 43635.24324, 77284.427211, 88219.213498], 
        [618971.821738, 178420.512942, 55369.062882, 252341.480194, 55015.549228, 88238.098629, 87639.149476, 45455.544088, 77894.899571, 89287.374835], 
        [632559.061613, 181435.126769, 56425.57228, 258515.508255, 56411.273636, 90239.522321, 89632.306643, 47312.75953, 78493.402138, 90349.148804], 
        [646367.200875, 184492.589317, 57495.115311, 264768.601794, 57841.959327, 92270.709229, 91545.83279, 49205.361453, 79080.110575, 91404.617155], 
        [660400.677033, 187594.174042, 58578.504146, 271102.111202, 59308.253538, 94331.410249, 93381.642599, 51131.821741, 79655.200547, 92453.861634], 
        [674663.927591, 190741.1544, 59676.550959, 277517.38687, 60810.803507, 96421.376276, 95141.650758, 53090.61228, 80218.847718, 93496.963989], 
        [689161.390058, 193934.80385, 60790.067924, 284015.779189, 62350.25647, 98540.358207, 96827.771948, 55080.204954, 80771.227752, 94534.005968], 
        [703897.501939, 197176.395849, 61919.867213, 290598.638551, 63927.259666, 100688.106937, 98441.920857, 57099.071648, 81312.516315, 95565.069319], 
        [718876.700743, 200467.203854, 63066.761001, 297267.315347, 65542.460332, 102864.373363, 99986.012167, 59145.684248, 81842.889069, 96590.235789], 
        [734103.423975, 203808.501321, 64231.56146, 304023.159969, 67196.505705, 105068.90838, 101461.960565, 61218.514639, 82362.52168, 97609.587127], 
        [749582.109143, 207201.561709, 65415.080763, 310867.522807, 68890.043023, 107301.462884, 102871.680733, 63316.034706, 82871.589811, 98623.20508], 
        [765317.193753, 210647.658473, 66618.131084, 317801.754254, 70623.719522, 109561.787771, 104217.087358, 65436.716334, 83370.269127, 99631.171395], 
        [781313.115312, 214148.065073, 67841.524597, 324827.204701, 72398.182442, 111849.633937, 105500.095124, 67579.031408, 83858.735293, 100633.567822], 
        [797574.311328, 217704.054964, 69086.073473, 331945.224539, 74214.079018, 114164.752277, 106722.618715, 69741.451813, 84337.163972, 101630.476106], 
        [814105.219306, 221316.901604, 70352.589888, 339157.164159, 76072.056488, 116506.893689, 107886.572816, 71922.449434, 84805.730829, 102621.977997], 
        [830910.276754, 224987.87845, 71641.886013, 346464.373953, 77972.762091, 118875.809066, 108993.872111, 74120.496157, 85264.611528, 103608.155242], 
        [847993.921179, 228718.258959, 72954.774022, 353868.204312, 79916.843063, 121271.249307, 110046.431286, 76334.063866, 85713.981734, 104589.089588], 
        [865360.590086, 232509.316589, 74292.066088, 361370.005628, 81904.946641, 123692.965305, 111046.165025, 78561.624447, 86154.01711, 105564.862784], 
        [883014.720985, 236362.324797, 75654.574385, 368971.128292, 83937.720063, 126140.707958, 111994.988012, 80801.649785, 86584.893322, 106535.556576], 
        [900960.75138, 240278.557039, 77043.111086, 376672.922695, 86015.810568, 128614.228161, 112894.814933, 83052.611764, 87006.786033, 107501.252714], 
        [919203.118779, 244259.286774, 78458.488365, 384476.739229, 88139.865391, 131113.27681, 113747.560472, 85312.98227, 87419.870907, 108462.032945], 
        [937746.260689, 248305.787457, 79901.518393, 392383.928285, 90310.53177, 133637.6048, 114555.139313, 87581.233189, 87824.32361, 109417.979016], 
        [956594.614616, 252419.332547, 81373.013345, 400395.840254, 92528.456943, 136186.963029, 115319.466142, 89855.836404, 88220.319805, 110369.172675], 
        [975752.618068, 256601.195501, 82873.785395, 408513.825528, 94794.288148, 138761.102391, 116042.455642, 92135.263802, 88608.035157, 111315.69567], 
        [995224.708551, 260852.649775, 84404.646714, 416739.234498, 97108.672621, 141359.773782, 116726.022499, 94417.987266, 88987.645329, 112257.629749], 
        [1015015.323572, 265174.968828, 85966.409477, 425073.417556, 99472.257601, 143982.728099, 117372.081397, 96702.478684, 89359.325987, 113195.05666], 
        [1035128.900638, 269569.426116, 87559.885857, 433517.725093, 101885.690324, 146629.716238, 117982.54702, 98987.209938, 89723.252794, 114128.05815], 
        [1055569.877256, 274037.295096, 89185.888026, 442073.5075, 104349.618028, 149300.489093, 118559.334055, 101270.652916, 90079.601416, 115056.715966], 
        [1076342.690933, 278579.849225, 90845.228159, 450742.115169, 106864.68795, 151994.797562, 119104.357184, 103551.279501, 90428.547515, 115981.111858], 
        [1097451.779175, 283198.361962, 92538.718429, 459524.898491, 109431.547328, 154712.39254, 119619.531093, 105827.561579, 90770.266757, 116901.327572], 
        [1118901.579489, 287894.106762, 94267.171008, 468423.207858, 112050.8434, 157453.024922, 120106.770467, 108097.971035, 91104.934805, 117817.444857], 
        [1140696.529382, 292668.357084, 96031.39807, 477438.39366, 114723.223402, 160216.445605, 120567.989989, 110360.979754, 91432.727325, 118729.54546], 
        [1162841.066362, 297522.386384, 97832.211789, 486571.806289, 117449.334573, 163002.405485, 121005.104345, 112615.059621, 91753.81998, 119637.711128]]

# GRID EMISSIONS FACTORS: REF Grid EFs kg CO2-eq per kwh									
# Emissions Factors!B11:K57
# TODO: Replace this with emissions_factors module once interface is better understood
ef_co2_eq_list = [
        ['World', 'OECD90', 'Eastern Europe', 'Asia (Sans Japan)', 'Middle East and Africa', 'Latin America', 'China', 'India', 'EU', 'USA'],
        [None, None, None, None, None, None, None, None, None, None],
        [0.617381628, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.613053712, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.605559021, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.599823764, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.596692109, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.592956465, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.589394210, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.585889941, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.582469966, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.579126508, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.576180724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.572640473, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.569484654, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.566378788, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.563317175, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.560425096, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.557305440, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.554345365, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.551409592, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.548493724, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.545513743, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.542688056, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.539794403, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.536903541, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.533998347, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.530880184, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.528185055, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.525268472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.522337859, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.519390128, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.516316183, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.513431317, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.510414389, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.507368630, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.504753472, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.503017663, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.501095098, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.499244741, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.497355610, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.495425752, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.493412239, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.491436597, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.489373931, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.487263794, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.485104746, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666], 
        [0.483057065, 0.454068989, 0.724747956, 0.457658947, 0.282243907, 0.564394712, 0.535962403, 0.787832379, 0.360629290, 0.665071666]]

class Cluster:

    def __init__(self):
        self.name = name

    def run_cluster(self):
        scenario = cluster_model.Scenario(name, assumptions)
        scenario.load_pop_data(DATADIR)
        scenario.load_tam_mix(current_tam_mix_list)
        scenario.load_ref2_tam(ref2_tam_list)
        scenario.calc_ref1_tam()
        scenario.calc_ref2_demand()
        scenario.calc_ref1_demand()
        scenario.calc_change_demand()
        scenario.calc_addl_units_highed()
        scenario.calc_addl_units_lowed()
        scenario.calc_emis_diff_highed_water(ef_co2_eq_list)
        scenario.calc_emis_diff_lowed_water()
        scenario.calc_emis_alloc_lldc()
        scenario.calc_addl_units_mdc()
        scenario.calc_emis_diff_mdc_water()
        scenario.calc_emis_alloc_mdc()
        scenario.calc_total_emis()
        scenario.print_total_emis()
        return scenario
        
if __name__ == "__main__":
    cluster = Cluster()
    cluster.run_cluster()